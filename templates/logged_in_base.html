{% extends "base.html" %}

{% load class_tags %}
{% load generic_flatblocks %}
{% load markup %}

{% block extra_head_base %}
  {% import_logged_in_css STATIC_URL %}
  {% block extra_head %}{% endblock %}
{% endblock %}

{% block header %}

<div style="margin-top: 10px">
  <div {% get_id_and_classes "header-logout" %}>
    <a href="/account/cas/logout/">Logout</a>
  </div>

  <div {% get_id_and_classes "header-logo" %}>
    <a href="{% url home_index %}"><img src="{{STATIC_URL}}css/default/images/logo.png" title="Home"/></a>
  </div>

  <div {% get_id_and_classes "header-info" %}>
    {% include "components/user_info.html" %}
  </div>  
  
  <div {% get_id_and_classes "header-nav" %}>
    {% include "components/navigation.html" %}
  
    <div {% get_id_and_classes "header-title" %}>
      <h3>{% block page_title %}{% endblock %}</h3>
    </div>  
    
  </div>
</div>

{% include "quests/quest_dialog.html" %}
{% include "quests/quest_list.html" %}

{# {% if help_info and user.get_profile.enable_help %} #}
{#   <div {% get_id_and_classes "notification" %}>  #}
{#     <div {% get_id_and_classes "notification-box" %}> #}
{#       Help Topics:  #}
{#       <ul {% get_id_and_classes "help-topics" %}> #}
{#       {% for number in help_info.count %} #}
{#         {% gblock help_info.prefix,number for "gblocks.TitleAndText" into "block_object" %} #}
{#         <li> #}
{#           <a id="help-title-{{number}}" href="#" onclick='$("#help-dialog-{{number}}").dialog("open"); return false;'> #}
{#           {% if block_object.title %} #}
{#             {{block_object.title}} #}
{#           {% else %} #}
{#             No title #}
{#           {% endif %} #}
{#           </a> #}
{#         </li> #}
{#       {% endfor %} #}
{#       </ul> #}
{#       <div {% get_id_and_classes "help-page" %}> #}
{#         {% gblock help_info.prefix for "gblocks.Text" with "help/page_help/help_box.html" %} #}
{#       </div> #}
{#     </div> #}
{#     <a href="#" onclick="$('#notification-box').fadeOut(); return false;"> #}
{#       <span style="margin-top: 1px; float:right" class="ui-icon ui-icon-close"></span> #}
{#     </a> #}
{#   </div> #}
{# {% endif %} #}


{% endblock %}

{% block extra_body_base %}
<script type="text/javascript">
  //Normally, we would wrap this in an anonymous function, but we want it to be available for later.
  // Get the spreadsheet we need.
  var energyLastThirtyDays = "https://spreadsheets.google.com/tq?key=0An9ynmXUoikYdHhxeW1xRURQZUlGd1oxVERnQktsWXc";
  var refreshInterval = 0; // don't refresh this spreadsheet.

  // Load the visualization API and the spreadsheet, then call displayRank.
  var loader = new org.wattdepot.gdata.GDataLoader(displayRank, energyLastThirtyDays, refreshInterval);  

  function displayRank(energyDataTable) {
    // The source for which we want to find the rank must be specified by Makahiki.
    var source = "{{user.get_profile.floor.floor_identifier}}";
    var energyRank = new org.wattdepot.gdata.makahiki.EnergyRank();
    // Get the usage for the current round and overall.
    {% for key, value in ROUNDS.items %}
      {% if key == "Overall" %}
      var usage = energyRank.processDataTable(energyDataTable, {{value.start}}, {{value.end}});
      var info = energyRank.calculateRankInfo(usage, source);
      energyRank.draw("overall-energy-rank", "overall-energy-value", info);
      {% else %}
        {% if CURRENT_ROUND and key == CURRENT_ROUND %}
        var curr_usage = energyRank.processDataTable(energyDataTable, {{value.start}}, {{value.end}});
        var curr_info = energyRank.calculateRankInfo(curr_usage, source);
        energyRank.draw("round-energy-rank", "round-energy-value", curr_info);
        {% endif %}
      {% endif %}
    {% endfor %}
  }
</script>

<script type="text/javascript">
$(document).ready(function(){
    $('a.frontendadmin_edit').hover(
        function(){$(this).parent().css('outline', '4px solid #E9B007')},
        function(){$(this).parent().css('outline', '')}
    );
    
    $('a.frontendadmin_edit').click(function(){
            $(this).parent().css('outline', '');
            $(this).parent().load(this.href);
            return false;
    });
    
    $('a.frontendadmin_delete').hover(
        function(){$(this).parent().css('outline', '4px solid #E9B007')},
        function(){$(this).parent().css('outline', '')}
    );
});
</script>

{# {% if help_info and user.get_profile.enable_help %} #}
{#   {% for number in help_info.count %} #}
{#   {% gblock help_info.prefix,number for "gblocks.TitleAndText" with "help/page_help/help_dialog.html" %} #}
{#    #}
{#   <script type="text/javascript">  #}
{#     $(document).ready(function() { #}
{#       $("#help-dialog-{{number}}").dialog({ #}
{#           modal: true, #}
{#           autoOpen: false #}
{#       }); #}
{#     }) #}
{#   </script>   #}
{#   {% endfor %} #}
{# {% endif %} #}

{% block extra_body %}{% endblock %}

{% endblock %}