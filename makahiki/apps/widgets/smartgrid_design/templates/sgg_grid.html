{% load sgg_design_tags %}

<div class="sgg_grid">
	<div class="sgg-dropzone">
		<div id="category-dropzone" class="sgg-category-dropzone">
			<table class="designer-table">
				<tr>
					{% for i in 8|get_range %}
					<td><div class="sgg-category-slot" data-column={{i|add:1}}>
					{% for cat in cat_list %}
						{% if i|add:"1" == cat.column %}
						<div id="category-menu-{{cat.category.slug}}" class="sgg-level-popup-menu">
							<ul>
								<li><a href="#{{forloop.counter}}" class="sgg-action"
								rel="tooltip" 
								title="Delete this column from the level. Moves all the actions in the column to the palette">Delete column {{cat.name}}</a>
								</li>
							</ul>
						</div> 
					<div id="category-{{cat.category.slug}}" data-slug="{{cat.category.slug}}" class="sgg-category grid-draggable" 
						 data-priority={{i}} data-pk={{cat.category.pk}} data-level="sgg-level-{{lvl.priority}}">
						 <br/>
						 <a class="sgg-category-link" href="/challenge_setting_admin/smartgrid_design/designercategory/{{cat.category.pk}}/">
						 {{cat.category.name}}</a>
						 <br/>
					</div>
<script type="text/javascript">
	$("#category-{{cat.category.slug}}").bind("contextmenu", function(e) {
		$('#category-menu-{{cat.category.slug}}').css({
			top: e.pageY+'px',
			left: e.pageX+'px'
		}).show();
		return false;
	});
	$("#category-menu-{{cat.category.slug}}").click(function() {
		$(this).hide();
	});
	$(document).click(function() {
		$("#category-menu-{{cat.category.slug}}").hide();
	});
</script>
						{% endif %}
					{% endfor %}
					</div></td>
					{% endfor %}
				</tr>
			</table>
		</div>
	</div>
	<div class="sgg-dropzone">
		<div id="action-dropzone" class="sgg-action-dropzone">
			<table class="designer-table">
				{% for r in 8|get_range %}
				<tr>
					{% for c in 8|get_range %}
					<td>
						{# Decide if column is active #}
						{% if c|add:"1" in columns %}
                        <div class="sgg-action-slot"						
						{% else %}
                        <div class="sgg-action-slot disabled"						
						{% endif %}
							data-column="{{ c|add:'1' }}" data-row="{{ r|add:'1' }}">
						{% for act in act_list %}
							{% if r|add:"1" == act.row and c|add:"1" == act.column %}
							<div data-slug="{{act.action.slug}}" class="sgg-action sgg-{{act.action.type}}-cell grid-draggable"
                   		   		 data-type="{{act.action.type}}" data-row="{{r|add:1}}" data-column="{{c|add:1}}" 
                   		   		 data-category="{{cat.slug}}" data-pk={{act.action.pk}} data-unlock="{{act.action.unlock_condition}}">
                   		   			<br/>
                   		   			<a href="/challenge_setting_admin/smartgrid_design/designer{{act.action.type}}/{{act.action.pk}}/"
									   class="sgg-action" ref="tooltip" title="{{act.action.title}}">{{act.action.name}}</a><br/>
								</div>									
							{% endif %}
						{% endfor %}
						</div>
					</td>
					{% endfor %}
				</tr>
				{% endfor %}
			</table>
		</div>
	</div>
</div>