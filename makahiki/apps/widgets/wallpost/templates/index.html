<div class="content-box">
    <div>
        <div class="content-box-title">
            {{ view_objects.wallpost.title }}
            <a href="#" style="float: right">
                <img src="{{ STATIC_URL}}images/icons/icon-help-sm.png" width="20"
                     align="center"
                     title="Click to get help about this window"
                     onclick="toggleHelp(event, 'widget', 'news-feed'); return false;"
                        /></a>
        </div>
        <div class="content-box-content wallpost-content">
            {{ view_objects.wallpost.description }}
            <div>
              <form id="news-post-form" action="{% url news_post %}" method="POST">
                  {% csrf_token %}
                  <div id="wall-post-errors"></div>
                  <div id="wall-post" class="control-group">
                    <div class="controls">
                      <textarea rows="2" id="id_post" name="post" placeholder="What's on your mind?"/></textarea>
                    </div>
                  </div>
                  {{ view_objects.wallpost.wall_form.page_name }}

                  <div>
                    <button id="wall-post-submit" class="btn btn-widget padded">
                        Post
                    </button>
                  </div>
                </form>
            </div>
            </br>
            <div class="btn-group">
                <button id="user-post" class="btn btn-primary" style="">User Posts</button>
                <button id="system-post" class="btn btn-primary" style="">System Posts</button>  
            </div>
            <ul class="wall-posts">
                {% include "news_posts.html" %}
            </ul>
            {% if not view_objects.wallpost.posts %}
                <p id="wall-no-posts" style="padding: 7px;">There are no posts yet!</p>
            {% endif %}
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
	  var textarea = $("#id_post");
	  var post_button = $("#wall-post-submit");
    var user_colored = true;
    var system_colored = true;
    var btnClass = "";
    var highlight_class = 'btn btn-primary';
    var normal_class = 'btn btn-info';

    $('#user-post').click( function() {
        $('.user-post').toggle();
        if(user_colored) {
          btnClass = normal_class;
        }
        else {
          btnClass = highlight_class;
        }
        user_colored = !user_colored;
        document.getElementById("user-post").setAttribute("class", btnClass);
    })

    $('#system-post').click( function() {
        $('.system-post').toggle();
        if(system_colored) {
          btnClass = normal_class;
        }
        else {
          btnClass = highlight_class;
        }
        system_colored = !system_colored;
        document.getElementById("system-post").setAttribute("class", btnClass);
    })


	  if (textarea) {
	      textarea.keyup(function() {
	          if (this.value.length === 0 && !post_button.hasClass("disabled")) {
	              post_button.addClass("disabled");
	          }
	          else if (this.value.length > 0 && post_button.hasClass("disabled")){
	              post_button.removeClass("disabled");
	          }
	      });   
	  }
	  if (post_button) {
	      post_button.addClass("disabled");

	      post_button.click(function() {
	          if (!post_button.hasClass("disabled")) {
	              $.post(this.form.action, $("#news-post-form").serialize(), 
                function(data) {
	                  if (data.message) {
	                      $("#wall-post-errors").html(data.message);
	                  }
	                  else {
	                      $("#wall-post-errors").html("");
	                      if ($("#wall-no-posts").is(":visible")) {
	                          $("#wall-no-posts").hide();
	                      }
	                      $(data.contents).prependTo(".wall-posts");
	                      textarea.val("");
	                      post_button.addClass("disabled");
	                  }
	              });
	          }
	          return false;
	      });
	  }
     
	});
</script>
