{% load sgg_design_tags %}
<script src="{{STATIC_URL}}js/jquery-ui-timepicker-addon.js"></script>

<div class="content-box">
	<div class="content-box-title">Unlock Condition Creator
       <a href="#" style="float: right">
            <img src="{{ STATIC_URL}}images/icons/icon-help-sm.png" width="20" align="center"
                 title="Click to get help about this window"
                 onclick="toggleHelp(event, 'widget', 'unlock-creator'); return false;"
                    /></a>
 	</div>
	<div id="content" class="content-box-contents">
		<div id="unlock_creator" class="container-fluid">
			<div class="row-fluid">
				<input name="unlock_condition_match" value="uc_match" type="checkbox"> Match the following unlock condition:
			</div>
			<div class="row-fluid predicate-row">
				<hr/>
				<div id="predicate_choice" class="span2">
					<select name="predicate_choice" id="predicate_choices">
					{% for predicate in view_objects.unlock_creator.predicates %}
						<option value="{{predicate}}">{{predicate}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="action_slug" class="span2">
					<select name="designer_action_choice" id="action_choice">
					{% for action_slug in view_objects.unlock_creator.action_slugs %}
						<option value="{{action_slug}}">{{action_slug}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="action_type" class="span2 hidden">
					<select name="designer_action_type_choice" id="action_type_choice">
					{% for value in view_objects.unlock_creator.action_types %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="event_slug" class="span2 hidden">
					<select name="designer_event_choice" id="event_choice">
					{% for value in view_objects.unlock_creator.event_slugs %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="game_name" class="span2 hidden">
					<select name="designer_game_choice" id="game_choice">
					{% for value in view_objects.unlock_creator.game_names %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="level_name" class="span2 hidden">
					<select name="designer_level_choice" id="level_choice">
					{% for value in view_objects.unlock_creator.level_names %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="resource" class="span2 hidden">
					<select name="designer_resource_choice" id="resource_choice">
					{% for value in view_objects.unlock_creator.resources %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="round_name" class="span2 hidden">
					<select name="designer_round_choice" id="round_choice">
					{% for value in view_objects.unlock_creator.round_names %}
						<option value="{{value}}">{{value}}</option>
					{% endfor %}
					</select>
				</div>
				<div id="count" class="span2 hidden">
					<input type="number" name="count" min="0" max="15" value="1">
				</div>
				<div id="date_string" class="span2 hidden">
					<input type="text" name="event_date" value="2013-06-12 10:38:32" id="id_date" class="hasDatepicker">
				</div>
				<div id="plus-sign" class="span1">
					<a class="enabled ticket-add circle" href="#"
                	   onclick="addPredicateRow(); return false;">+</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

function hideAllParameters() {
	$('#action_slug').addClass('hidden');
	$('#action_type').addClass('hidden');
	$('#event_slug').addClass('hidden');
	$('#game_name').addClass('hidden');
	$('#level_name').addClass('hidden');
	$('#resource').addClass('hidden');
	$('#round_name').addClass('hidden');
	$('#count').addClass('hidden');
	$('#date_string').addClass('hidden');
}

$(function() {
	  $('#id_date').datetimepicker({ dateFormat: 'yy-mm-dd', timeFormat: 'hh:mm:ss' });
});

function addPredicateRow() {
	var copy = $('.predicate-row:first').clone();
	$('#unlock_creator').append(copy);
}

var predSelect=document.getElementById("predicate_choices")
predSelect.onchange=function() {
	hideAllParameters();
	var chosenOption = this.options[this.selectedIndex];
	log.debug("predicate selected = " + chosenOption.value);
	jQuery.ajax({
		url: "/unlock_creator/predicate_parameters/" + chosenOption.value + "/",
		success: function(data) {
			var parameters = data.parameters;
			for (var i = 1; i < parameters.length; i++) {
				log.debug(parameters[i])
				var item = $('#' + parameters[i]);
				if (item) {
					item.removeClass('hidden');
				}
				
			}
		}
	});
}
</script>