{% extends "status/base.html" %}

{% load class_tags %}

{% block body %}

<div {% get_id_and_classes "status-energy" %}>
  <div class="content-box">
    <div class="content-box-title">
      Energy Scoreboards
    </div>
    <div class="content-body">
      {% for key, value in ROUNDS.items %}
      <div style="float: left; margin: 10px; padding: 0 10px; border-right: 1px solid gray">
        <h4>{{key.capitalize}}</h4>
        <table id="{{key|slugify}}-energy-scoreboard">
        </table>
      </div>
      {% endfor %}
      <br style="clear: both"/>
    </div>
  </div>
</div>

<script type="text/javascript">
// Wrap this code in an anonymous self-invoking function to avoid polluting global namespace.
(function() {
  // Get the spreadsheet we need.
  var energyLastThirtyDays = '{{SPREADSHEETS.THIRTY_DAYS}}';
  var refreshInterval = 0; // don't refresh this spreadsheet.

  // Load the visualization API and the spreadsheet, then call displayRank.
  var loader = new org.wattdepot.gdata.GDataLoader(displayRank, energyLastThirtyDays, refreshInterval);  

  function displayRank(energyDataTable) {
    // The source for which we want to find the rank must be specified by Makahiki.
    var energyRank = new org.wattdepot.gdata.makahiki.EnergyRank();
    
    // Get the usage for the current round and overall.
    {% for key, value in ROUNDS.items %}
      var usage = energyRank.processDataTable(energyDataTable, {{value.start}}, {{value.end}});
      var info = energyRank.calculateRankInfo(usage, null);
      
      // Check if this is overall information.
      // alert("{{key|slugify}}");
      energyRank.drawCompleteStandings("{{key|slugify}}-energy-scoreboard", null, usage);
    {% endfor %}
  }
})();
</script>

{% endblock %}
