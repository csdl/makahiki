{% extends "base.html" %}

{% load class_tags %}
{% load generic_flatblocks %}
{% load markup %}

{% block extra_head_base %}
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript" src="{{STATIC_URL}}/js/com.iskitz.ajile.js?mvcoff,mvcshareoff,refresh"></script>
  <script type="text/javascript" src="{{STATIC_URL}}/js/org.wattdepot.gdata.GDataLoader.js"></script>
  <script type="text/javascript" src="{{STATIC_URL}}/js/org.wattdepot.gdata.makahiki.EnergyRank.js"></script>
  
  {% import_page_css "status" STATIC_URL CSS_THEME %}
{% endblock %}

{% block header %}
<h1 {% get_id_and_classes "status-title" %}>{{COMPETITION_NAME}} Mission Control</h1>
<ul {% get_id_and_classes "status-nav" %}>
  <li><a href="{% url status_points %}">Points Scoreboards</a></li>
  <li><a href="{% url status_energy %}">Energy Scoreboards</a></li>
  <li><a href="{% url status_users %}">Users</a></li>
  <li><a href="{% url status_prizes %}">Prizes</a></li>
  <li><a href="{% url status_activities %}">Activities and Commitments</a></li>
  <li><a href="{% url status_rsvps %}">Event RSVPs</a></li>
</ul>
{% endblock %}

{% block extra_body_base %}

<script type="text/javascript">
  // Normally, we would wrap this in an anonymous function, but we want it to be available for later.
  // Get the spreadsheet we need.
  var energyLastThirtyDays = '{{SPREADSHEETS.THIRTY_DAYS}}';
  var refreshInterval = 0; // don't refresh this spreadsheet.

  // Load the visualization API and the spreadsheet, then call displayRank.
  var loader = new org.wattdepot.gdata.GDataLoader(displayRank, energyLastThirtyDays, refreshInterval);  

  function displayRank(energyDataTable) {
    // The source for which we want to find the rank must be specified by Makahiki.
    var source = '{{user.get_profile.floor.dorm.name}}-{{user.get_profile.floor.number}}';
    var energyRank = new org.wattdepot.gdata.makahiki.EnergyRank();
    
    // Get the usage for the current round and overall.
    {% for key, value in ROUNDS.items %}
      var usage = energyRank.processDataTable(energyDataTable, {{value.start}}, {{value.end}});
      var info = energyRank.calculateRankInfo(usage, source);
      
      // Check if this is overall information.
      {% if key == "Overall" %}
      energyRank.draw("overall-energy-rank", "overall-energy-value", info);
      {% else %}
        // Check if this is info for the current round.
        {% if CURRENT_ROUND and key == CURRENT_ROUND %}
        energyRank.draw("round-energy-rank", "round-energy-value", info);
        {% endif %}
      {% endif %}
      
      {% block extra_round_energy %}{% endblock %}
    {% endfor %}
  }
</script>

{% block extra_body %}{% endblock %}

{% endblock %}