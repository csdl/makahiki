{% extends "logged_in_base.html" %}

{% load markup %}

{% load avatar_tags %}
{% load class_tags %}

{% block page_title %}
  Get Nuts!
{% endblock %}

{% block extra_head %}
  {% import_page_css "view_activities" STATIC_URL CSS_THEME %}
{% endblock %}

{% block body %}
<div {% get_id_and_classes "activity-task-stats" %}>  
  <div {% get_id_and_classes "activity-task-stats-box" %}>
    <div {% get_id_and_classes "activity-task-stats-title" %}>
      {{ task.type|capfirst }} : {{task.name}}
    </div>   
    <div {% get_id_and_classes "activity-task-stats-content" %}>   
      <p/>
      This {{task.type}} is worth {{task.point_value}} points.
      {% if task.type == "commitment" %}
        It lasts {{task.duration}} days.
      {% endif %}
      {% if task.type == "event" or task.type == "excursion" %}
      <p/>
      <b>When</b>  : {{task.event_date}} <br/>
      <b>Where</b> : {{task.event_location}}
      {% endif %}
      <p/>
      {{member_all}} 
      {% if member_all == 1 %}
        person has
      {% else %}
        people have 
      {% endif %}
      done this.
      <p/>
      {{member_floor}}  
      {% if member_floor == 1 %}
        person in your lounge has
      {% else %}
        people in your lounge have 
      {% endif %}
      done this.
      <br/>
      {% for user in users %}
         <img src="{% avatar_url user 40 %}"/>
     {% endfor %}
    </div>
  </div>  
</div>

<div {% get_id_and_classes "activity-task-details" %}>
  <div {% get_id_and_classes "activity-task-details-box" %}>
    <div {% get_id_and_classes "activity-task-details-title" %}>
      About the {{task.type}}
    </div>
    <div {% get_id_and_classes "activity-task-details-content" %}>
      <p/>
      <center><b>{{task.title}}</b></center>
      
      <p/>
      
      {{task.description|markdown}}

      <p/>  
      <center> 
      {% if pau %}
        {% if approval.approval_status == "approved" %}
          <b>Congratulations! You did it and earned {{task.point_value}} points! <br/>
          Thank you for your participation.
        {% else %}
          {% if task.type == "event" or task.type == "excursion" %}
            <b>Thank you! You've earned 2 points by signing up.<p/>
            After the {{task.type}}, please come back here to get your points.
          {% endif %}
          {% if task.type == "commitment" %}
             <b> Thank you! You've earned 2 points by committing.<p/>
              Come back in 5 days of meeting your commitment for the rest of 
              your points.
          {% endif %}         
          {% if task.type == "activity" %}
            {% if approval.approval_status != "rejected" %}
              <b>Thank you for submitting your response.   <p/>
              An administrator is reviewing your response.  <br/>
              Come back soon to see your new total.
            {% else %}
              <div style="text-align:left"><span style="font-weight: bold">The administrator feels that there is a problem with your submission. <br/>
              Here is the feedback: </span>
              {{approval.admin_comment|markdown}}    
              </div>
              <a href="#" class="{% insert_classes "ui-button" %}" onclick="task_form_overlay()"><button>I will try again</button></a> 
            {% endif %}
          {% endif %}            
        {% endif %}  
        
      {% else %}               <!-- not done yet  -->
        {% if task.type == "commitment" %}
          <a href="#" class="{% insert_classes "ui-button" %}" onclick="task_form_overlay()"><button>I will do this!</button></a>
        {% endif %}  
        {% if task.type == "event" or task.type == "excursion" %}
          <a href="#" class="{% insert_classes "ui-button" %}" onclick="task_form_overlay()"><button>I want to sign up</button></a>
        {% endif %} 
        {% if task.type == "survey" %}
          <a href="#" class="{% insert_classes "ui-button" %}" onclick="task_form_overlay()"><button>I want to do it</button></a>
        {% endif %} 
        {% if task.type == "activity"%} 
          Once you are done, click the button below to get your points!
          <p/>
          <a href="#" class="{% insert_classes "ui-button" %}" onclick="task_form_overlay()"><button>I Did This!</button></a> 
        {% endif %} 
      {% endif %}
       <br/> <br/>
       <!--
         <a href="/activities/" id="back" class="{% insert_classes "ui-button" %}">Go Back</a>  
       -->  
      </b></center> <p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_body %}
<div id="setup-dialog" title="{{form_title}}" style="visibility: hidden;">
    {% include "view_activities/task_form.html" %}
</div>

<script type="text/javascript"> 
function task_form_overlay()
{
  el = document.getElementById("setup-dialog"); 
  el.style.visibility = "visible";
  $("#setup-dialog").dialog({
    modal: true,
    width: 450,
    closeOnEscape: false,
    position: ["center", 75]
    });
}

{% if display_form %}
   $(document).ready(task_form_overlay());
{% endif %}    

</script>  

<div id="signup-point-dialog" title="Thank you" style="visibility: hidden;">
    <p/>
    {% if approval.approval_status == "approved" %}
       You just got {{task.point_value}} points !
    {% else %}   
      {% if task.type == "activity" %}
       <p style="text-align:left">
       Thank you for submitting your response.   
       </p>
       <p style="text-align:left">
       An administrator will review it and approve your points, usually within a few hours.  
       You can see the status of your submission on your Profile Page.  
       </p>
     
       <p style="text-align:left">
        Come back soon to see your new total.
       </p>
       {% else %}
         You just got 2 points !
       {% endif %}  
    {% endif %}        
    
    <p/>
    <center>
    <input type="submit" value="OK" onclick='$("#signup-point-dialog").dialog("close");' /> 
    </center>
   
</div>

<script type="text/javascript"> 
function signup_point_dialog_overlay()
{
  el = document.getElementById("signup-point-dialog"); 
  el.style.visibility = "visible";
  $("#signup-point-dialog").dialog({
    modal: true,
    {% if task.type == "activity" %}
      width: 400,
      height: 250,
    {% else %}
      width: 300,
      height: 150,
    {% endif %}
    closeOnEscape: false,
    position: ["center", 200]
    });
}

{% if display_point %}
     $(document).ready(signup_point_dialog_overlay());
{% endif %}    

</script>  


{% endblock %}
