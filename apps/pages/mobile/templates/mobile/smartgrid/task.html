{% extends "mobile/base.html" %}


{% block body %}

{% load markup %}
<div data-role="page" id="task">
  <header data-role="header" data-theme="b">
    <a href="" data-icon="back" data-rel="back">Back</a>
    <h1>{{task.name}}</h1>
    <a href="{% url mobile_index %}" rel="external" data-role="button" data-icon="home" data-iconpos="notext">Home</a>
  </header>

   <div data-role="content">
    <div>
      {% if pau %}
        {% if approval.approval_status == "approved" or approval.award_date %}
          <div class="ui-body ui-body-e">
          <p/>
          Congratulations! You did it and earned {{task.point_value}} points! <br/>
          Thank you for your participation.
          </div>
        {% else %}
          {% if task.type == "event" or task.type == "excursion" %}
            <div class="ui-body ui-body-e">
            <p/>
            {% if task.is_event_completed %}
            Thank you for attending the event. <br/>
            Click on the "I Did it" button to get the rest of your points. <br/>
            <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I Did it</a> 
            {% else %}
            Thank you! You've earned 2 points by signing up.<br/>
            After the {{task.type}}, please come back here to get your points.
            {% endif %}
             </div>
          {% endif %}
          {% if task.type == "commitment" %}
             <div class="ui-body ui-body-e">
             <p/>
              {% if approval.days_left != 0 %}
              Thank you! You've earned 2 points by committing.<br/>
              You have {{approval.days_left}} days left to come back to get the rest of your points.
              {% else %}
              Thank you for committing to this for {{task.duration}} days. <br/>
              Click on the "I Did it" button to get the rest of your points. <br/>
              <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I Did it</a> 
              {% endif %}
             </div>
          {% endif %}         
          {% if task.type == "activity" %}
            {% if approval.approval_status != "rejected" %}
              <div class="ui-body ui-body-e">
              <p/>
              Thank you for submitting your response.   <br/>
              An administrator is reviewing your response.  <br/>
              Come back soon to see your new total.
              </div>
            {% else %}
              <div>
              <p/>
              <div class="ui-body ui-body-e">
              Administrator feels that there is a problem with your submission. <br/>
              Please try again. Here is the feedback: <br/>             
              <span style="color:orange">{{approval.admin_comment}}</span>
              </div>
              <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I will try again</a> 
              </div>
            {% endif %}
          {% endif %}            
        {% endif %}  
      {% endif %}
      
      
      <p/>
      <center><b>{{task.title}}</b></center>
      
      <p/>
      
      {{task.description|markdown}}

      <p/>  
      <center> 
        
      {% if not pau %}              <!-- not done yet  -->
        {% if task.type == "commitment" %}
          {% if can_commit %}
            <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I will do this!</a>
          {% else %}
            <b>You already have 5 pending commitments. <br/>
            You can continue making this commitment once any of your pending commitment is approved.
            </b>
          {% endif %}
        {% endif %}  
        {% if task.type == "event" or task.type == "excursion" %}
           {% if task.is_event_completed %}
            <b>This event was already completed at {{task.event_date}}. <br/>
               If you attended the event, Click on the "I Did it" button to get your points. <br/>
            <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I Did it</a>
            </b>
           {% else %}
            <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I want to sign up</a>
           {% endif %}
        {% endif %} 
        {% if task.type == "survey" %}
          <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I want to do it</a>
        {% endif %} 
        {% if task.type == "activity"%}
          <b>
          Once you are done, click the button below to get your points!
          </b>
          <p/>
          <a href="{% url mobile_smartgrid_task task.id %}/#form" data-role="button" data-rel="dialog">I Did This!</a> 
        {% endif %} 
      {% endif %}
       <br/> <br/>
      </center> <p>
    </div>
<!--
    <a href="{% url mobile_landing %}smartgrid/task/{{task.id}}/#form" data-role="button" data-rel="dialog" rel="external "data-transition="pop">
      I did this! - not part of desktop
    </a>
-->
  </div>
  
  <footer>
  </footer>
</div>

<div data-role="page" id="form" data-url="form">
  <div data-role="header">
    <h1>{{task.name}}</h1>
  </div>

  <div data-role="content">
    <form id="myform" action="{% url mobile_smartgrid_add task.id %}" method="post">

    {% csrf_token %}

    {% if admin_message %}
      Admin message: {{ admin_message }}
    {% endif %}
  
    <p/>
      {% if task.type == "event" or task.type == "excursion" %}          {# event #}
        {% if task.is_event_completed %}
          Please enter the confirmation code you receieved from the event:
          {{ form.code }}
          {{ form.response.errors }}
          {{ form.response }}
          <div>
            <button>Submit</button>
            <a href="{% url mobile_smartgrid %}/task/{{task.id}}" data-role="button" data-rel="back">
              Cancel</a>
          </div>
        {% else %}
          You will earn 2 points for signing up for the {{task.type}}.
          <div>
            <button>OK, Let's do it</button>
            <a href="{% url mobile_smartgrid %}/task/{{task.id}}" data-role="button" data-rel="back">
              I don't want to do it</a>
          </div>
        {% endif %}
     <!--
        <p/>(Optional) Provide comment for Kukui Cup Admin:<br/>
          {{ form.comment }} 
        <p/>
     -->
    {% endif %}
   
    {% if task.type == "commitment" %}     {# commitment #}
      {% if approval.days_left != 0 %}
        You will earn 2 points for making this commitment.
        <p/>
        Come back in 5 days of meeting your commitment for the rest of your 
        points.
      {% else %}
        Thank you for the commitment.
        <p/>
        You've earned {{task.point_value}} points.
      {% endif %}
      <div>
        <button>OK, Let's do it</button>
        <a href="{% url mobile_smartgrid %}/task/{{task.id}}" data-role="button" data-rel="back">
          I don't want to do it</a>
      </div>
    {% endif %}

    {% if task.type == "activity" %}          {# activity #}
      {% if form.image_response %}         {# image #}
        {{task.confirm_prompt}} <p/>
        {{ form.image_response.errors }}
        {{ form.image_response }}
      {% else %}                           
        {% if question %}                                {# question #}
        Please answer the following question(s) and submit your answer(s).
        <br>You can also click on the "Cancel" button to go back to review the information.
        <p/>
        {{task.confirm_prompt}} <p/>
        {{form.question}}
        <b>{{question.question}}</b> <br/>
        {% if question.questionchoice_set.count > 0 %}    {# choice response question #}
          {{ form.choice_response.errors }}
          {{ form.choice_response }}
        {% else %}                                        {# text response question #}
          {{ form.response.errors }}
          {{ form.response }}
        {% endif %}  
      {% else %}                                       {# free text #}
        {{task.confirm_prompt}} <p/>
        {{ form.response.errors }}
        {{ form.response }}    
      {% endif %}  
    {%endif%}
    <!--
    <p/>(Optional) Provide comment for Kukui Cup Admin:<br/>
         {{ form.comment }} 
    <p/>
    -->
      <div>
        <button>Submit</button>
        <a href="{% url mobile_smartgrid %}/task/{{task.id}}" data-role="button" data-rel="back">
           Cancel</a>
      </div>
    {% endif %}
  
    {% if task.type == "survey" %}          {# survey #}   
      {{task.confirm_prompt}} <p/>
      {% for field in form %}
        <b>{{ field.label }}</b> <br/>
        {{ field.errors }}
        {{ field }}
        <p/>
        {% endfor %}
        <div>
          <button>Submit</button>
          <a href="{% url mobile_smartgrid %}/task/{{task.id}}" data-role="button" data-rel="back">
            Cancel</a>
        </div>
    {% endif %}
    </form>

    <!--a href="{% url mobile_smartgrid_task task.id %}" data-role="button" data-rel="back">Cancel</a-->
  </div>

  <div data-role="footer">
  </div>
</div>

{% endblock %}
