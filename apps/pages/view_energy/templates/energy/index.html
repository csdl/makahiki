{% extends "logged_in_base.html" %}

{% load class_tags %}

{% block page_title %}
  Go Low!
{% endblock %}

{% block extra_head %}
  {% import_page_css "view_energy" STATIC_URL CSS_THEME %}
  <script type="text/javascript" src="http://wattdepot-gdata.googlecode.com/svn/trunk/src/javascript/powermeter/org.wattdepot.gdata.makahiki.PowerMeter.js"></script> 
{% endblock %}

{% block body %}

<div {% get_id_and_classes "energy-power-scoreboard" %}>
  <div {% get_id_and_classes "energy-power" %}>
    <div {% get_id_and_classes "energy-power-title" %}>
      Current Lounge Power
      {# <a href="#" onclick="$('#help-dialog1').dialog('open')"> #}
      {# <span id="help1" class="ui-icon ui-icon-help"></span> #}
      {# </a>   #}
    </div>
    <div {% get_id_and_classes "energy-power-content" %}>
      <center>
      {% include "energy/power.html" %}  
      </center>
    </div>
  </div>
  
  <p>
  {% include "energy/scoreboard.html" %}
</div>

<div {% get_id_and_classes "energy-status" %}>
  <div {% get_id_and_classes "energy-status-box" %}>
    <div {% get_id_and_classes "energy-status-title" %}>
      Daily Energy Goal Status
      {# <a href="#" onclick="$('#help-dialog3').dialog('open')"> #}
      {# <span id="help3" class="ui-icon ui-icon-help"></span> #}
      {# </a>   #}
    </div>
    <div {% get_id_and_classes "energy-status-content" %}>
      {% if over == "over" %}
        <img src="{{ STATIC_URL}}images/energy/SadFaceIcon.png" width="30" height="30" />
        <font color="red"><b>
        Goal: {{goal}} kWh ({{percent_reduce}}% reduction).  
        Status: {{actual}} kWh ({{diff}} kWh {{over}} goal)
      </b></font>
      {% else %}
        <img src="{{ STATIC_URL}}images/energy/SmileFaceIcon.png" width="30" height="30" />
        <font color="green"><b>
        Goal: {{goal}} kWh ({{percent_reduce}}% reduction).  
        Status: {{actual}} kWh ({{diff}} kWh {{over}} goal)
      </b></font>
      {% endif %}

      <fieldset {% get_id_and_classes "energy-status-progress" %}>
	    <legend>Daily Energy Goal Progress</legend>
        <table {% get_id_and_classes "energy-status-progress-table" %}>
          <tr>
            <td>
             {% include "energy/usage.html" %}
            </td>
            <td {% get_id_and_classes "energy-status-progress-about" %}>
                  Each member receives 20 points<br/>
                  each day that we make our goal.<br/>
            </td>
          </tr>
        </table>
      </fieldset>
	
      <fieldset {% get_id_and_classes "energy-status-how" %}>
	    <legend>How can we make our daily goal?</legend>		
        <table {% get_id_and_classes "energy-status-how-table" %}>
          <tr {% get_id_and_classes "energy-status-how-calculator" %}>
            <td {% get_id_and_classes "energy-status-how-calculator-content" %}>
               
                We need to conserve energy to meet our goal, but what does {{diff}} kWh mean?
                
                <p/>
                
                <div {% get_id_and_classes "energy-status-how-calculator-content-data" %}>
                  To save {{diff}} kWh, we must reduce
                
                <select onchange="cal_energy(this.options[this.selectedIndex]);" >
                  {% for type,hour in appliances %}
                   <option value="{{hour}}">{{type}}</option> 
                  {% endfor %}
                </select>
                
                <div id="cal_energy_text">by {{appliances.0.1}} hours
                </div>
                </div>
              <script type="text/javascript">
              function cal_energy(selected)
              {
                document.getElementById("cal_energy_text").innerHTML = 
                "by "+selected.value+" hours</p>"
              }
              </script>
            </td> 
            <td {% get_id_and_classes "energy-status-how-activities-content" %}>
                The following activities can help your lounge conserve energy, and you earn points!
                 {% include "energy/golow_activities.html" %}
            </td>
          </tr>   
        </table> 
      </fieldset>

      <fieldset {% get_id_and_classes "energy-status-posts" %}>
    	<legend>Organize with your lounge peeps</legend>
          Got ideas on how to conserve energy? Share it on the lounge wall:<br>

    <div {% get_id_and_classes "news-wall-content" %}>
      <div {% get_id_and_classes "wall-form" %}>
        <form {% get_id_and_classes "news-post-form" %} action="{% url energy_post %}" method="POST">
          {% csrf_token %}
          <div {% get_id_and_classes "wall-post-errors" %}></div>
          <div {% get_id_and_classes "wall-post" %}>
            {{wall_form.post}}
          </div>
          <a {% get_id_and_classes "wall-post-submit" %} href="#">Post</a>
        </form>
        <script type="text/javascript">
          $("#wall-post-submit").click(function() {
            if (!$("#wall-post-submit").button("option", "disabled")) {
              $.post("{% url energy_post %}", $("#news-post-form").serialize(), function(data) {
                if (data.message) {
                  $("#wall-post-errors").html(data.message);
                }
                else {
                  $("#wall-post-errors").html("");
                  if ($("#wall-no-posts").is(":visible")) {
                    $("#wall-no-posts").hide();
                  }
                  $(data.contents).hide().prependTo("#wall-posts").fadeIn();
                  $("textarea").val("");
                  $("#wall-post-submit").button("option", "disabled", true);
                }
              });
            }
            return false;
          });
        </script>
      </div>

        <ul {% get_id_and_classes "wall-posts" %}>
          {% include "news/news_posts.html" %}
        </ul>
        {% if not posts %}
          <p {% get_id_and_classes "wall-no-posts" %}>There are no posts yet!</p>
        {% endif %}

      </fieldset>
    </div>
  </div>

</div>

{% endblock %}

{% block extra_round_energy %}
  {# Note: contents are inserted into Javascript in the middle of the round iterator. #}
  {# Usage is already calculated for us there. #}
  {# See PROJECT_ROOT/templates/logged_in_base.html #}
  if ($("#{{key|slugify}}-energy-scoreboard") != null) {
    energyRank.drawCompleteStandings("{{key|slugify}}-energy-scoreboard", "{{user.get_profile.floor.floor_identifier}}", usage);
  }
{% endblock %}

{% block extra_body %}
<script type="text/javascript">
  $(document).ready(function() {
    $("#energy-scoreboard").cycle({height: "430px"});
  })
</script>
{% endblock %}