{% extends "logged_in_base.html" %}

{% load class_tags %}

{% block page_title %}
  Manage Your Profile
{% endblock %}

{% block extra_head %}
  {% import_page_css "view_profile" STATIC_URL CSS_THEME %}
{% endblock %}

{% block body %}
<div {% get_id_and_classes "profile-form" %}>
  <div {% get_id_and_classes "profile-form-box" %}>
    <div {% get_id_and_classes "profile-form-title" %}>
      My Info
    </div>
    <div {% get_id_and_classes "profile-form-content" %}>
      {% include "view_profile/components/form.html" %}
    </div>
  </div>
</div>

<div {% get_id_and_classes "profile-badges" %}>
  <div {% get_id_and_classes "profile-badges-box" %}>
    <div {% get_id_and_classes "profile-badges-title" %}>
      My Badges
    </div>
    <div {% get_id_and_classes "profile-badges-content" %}>
      {# <h5>Individual Badges</h5> #}
      <table {% get_id_and_classes "profile-user-badge-table" %}>
        <tr>
          <th {% get_id_and_classes "profile-user-badge-image-header" %}></th>
          <th {% get_id_and_classes "profile-user-badge-text-header" %}>Badge</th>
          <th {% get_id_and_classes "profile-user-badge-achievement-header" %}>Achievement</th>
        </tr>
        {% if user.badges_earned.count > 0 %}
          {% for awarded in user.badges_earned.all %}
          <tr>
            <td><img src="{{STATIC_URL}}{{awarded.badge.image}}"/></td>
            <td>{{awarded.badge.name}}</td>
            <td>{{awarded.badge.description.0}}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr {% get_id_and_classes "profile-user-badge-empty" %}><td colspan="3">You don't have any badges yet!</td></tr>
        {% endif %}
      </table>
      <div {% get_id_and_classes "profile-badge-catalog" %}>
        <a href="#">See Badge Catalog</a>
      </div>
    </div>
  </div>
</div>

<div {% get_id_and_classes "profile-history" %}>
  <div {% get_id_and_classes "profile-history-box" %}>
    <div {% get_id_and_classes "profile-history-title" %}>
      My Achievements
    </div>
    <div {% get_id_and_classes "profile-history-content" %}>
      <h5 {% get_id_and_classes "profile-history-current" %}>Current and Pending</h5>
      <table {% get_id_and_classes "profile-history-current-table" %}>
        <tr {% get_id_and_classes "profile-history-current-table-header" %}>
          <th {% get_id_and_classes "profile-history-current-date-header" %}>Date</th>
          <th {% get_id_and_classes "profile-history-current-task-header" %}>Task</th>
          <th {% get_id_and_classes "profile-history-current-status-header" %}>Status</th>
        </tr>
        {% if in_progress_members %}
          {% for member in in_progress_members %}
            {% if member.activity %}
            <tr>
              <td>{{member.created_at|date:"n/j/y"}}</td>
              <td>Activity: {{member.activity}}</td>
              <td>{{member.approval_status.capitalize}}</td>
            </tr>
            {% else %}
            <tr>
              <td>{{member.created_at|date:"n/j/y"}}</td>
              <td>Commitment: {{member.commitment}}</td>
              <td>In Progress</td>
            </tr>
            {% endif %}
          {% endfor %}
        {% else %}
        <tr {% get_id_and_classes "profile-history-current-empty" %}><td colspan="3">You have nothing in progress or pending.</td></tr>
        {% endif %}
      </table>
      
      <h5 {% get_id_and_classes "profile-history-previous-header" %}>Previously Awarded</h5>
      <table {% get_id_and_classes "profile-history-previous-table" %}>
        <tr {% get_id_and_classes "profile-history-previous-table-header" %}>
          <th {% get_id_and_classes "profile-history-previous-date-header" %}>Date</th>
          <th {% get_id_and_classes "profile-history-previous-task-header" %}>Task</th>
          <th {% get_id_and_classes "profile-history-previous-points-header" %}>Points</th>
        </tr>
        {% if completed_members %}
          {% for member in completed_members %}
            <tr>
              <td>{{member.award_date|date:"n/j/y"}}</td>
              {% if member.commitment %}
              <td>Commitment: {{member.commitment}}</td>
              <td>{{member.commitment.point_value}}</td>
              {% else %}
              <td>Activity: {{member.activity}}</td>
              <td>{{member.activity.point_value}}</td>
              {% endif %}
            </tr>
          {% endfor %}
        {% else %}
          <tr {% get_id_and_classes "profile-history-previous-empty" %}><td colspan="3">You have not been awarded anything yet!</td></tr>
        {% endif %}
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_body %}
  {% if fb_enabled %}
  <div id="fb-root"></div>
  <script src="http://connect.facebook.net/en_US/all.js"></script>
  <script>
    FB.init({appId: '{{FACEBOOK_APP_ID}}', status: true, cookie: true, xfbml: true});
  </script>
  {% endif %}

{% endblock %}