{% extends "logged_in_base.html" %}

{% load class_tags %}

{% block page_title %}
  What's going on in the cup?
{% endblock %}

{% block extra_head %}
  {% import_page_css "news" STATIC_URL CSS_THEME %}
  <script type="text/javascript">
    $(document).ready(function() {
      var textarea = $("textarea");
      textarea.click(function() {
        if ($("#wall-post-submit").button("option", "disabled")) {
          this.value = "";
        }
      });
      textarea.keyup(function() {
        if (this.value.length == 0) {
          $("#wall-post-submit").button("option", "disabled", true);
        }
        else {
          $("#wall-post-submit").button("option", "disabled", false);
        }
      });
      
      $("#wall-post-submit").button({
        disabled: true
      });
      
      $("#wall-post-submit").click(function() {
        if (!$(this).button("option", "disabled")) {
          $.post("{% url news_post %}", $("#news-post-form").serialize(), function(data) {
            if (data.message) {
              $("#wall-post-errors").html(data.message);
            }
            else {
              $("#wall-post-errors").html("");
              $(data.contents).hide().prependTo("#wall-posts").fadeIn();
              textarea.val("");
              $("#wall-post-submit").button("option", "disabled", true);
            }
          });
        }
        return false;
      });
      
    });
  </script>
{% endblock %}

{% block body %}
<div {% get_id_and_classes "news-events+popular+activities" %}>
  <div {% get_id_and_classes "news-events" %}>
    <div class="{% insert_classes "widget-title" %}">
      Upcoming Events
    </div>
    <div class="{% insert_classes "widget-body" %}">
      <table>
        <tr>
          <th>Event (points)</th>
          <th>Date</th>
          <th>Location</th>
        </tr>
        <tr>
          <td>Sustainable UH talk (5)</td>
          <td>Mon</td>
          <td>Mokihana Roof Lounge</td>
        </tr>
        <tr>
          <td>An Inconvenient Truth (5)</td>
          <td>Tue</td>
          <td>Ilima Roof Lounge</td>
        </tr>
        <tr>
          <td>Surfrider Beach Cleanup (5)</td>
          <td>Wed</td>
          <td>Ilima Parking Lot</td>
        </tr>
        <tr>
          <td>Blue Planet Talk(5)</td>
          <td>Wed</td>
          <td>Lehua Roof Lounge</td>
        </tr>
        <tr>
          <td>AMP Poetry Slam (5)</td>
          <td>Fri</td>
          <td>Hale Aloha Cafeteria</td>
        </tr>
      </table>
    </div>
  </div>
  
  <div {% get_id_and_classes "news-most-popular" %}>
    <div class="{% insert_classes "widget-title" %}">
      Most Popular
    </div>
    <div class="{% insert_classes "widget-body" %}">
      <form>
        <select>
          <option>Activities</option>
          <option>Events</option>
          <option>Commitments</option>
        </select>  
      </form>
      
      <table>
        <tr>
          <th>Activity</th>
          <th>Completions</th>
        </tr>
        <tr>
          <td>Be Energy Akamai</td>
          <td>345</td>
        </tr>
        <tr>
          <td>Blue Planet Foundation</td>
          <td>145</td>
        </tr>
        <tr>
          <td>Energy Audit</td>
          <td>123</td>
        </tr>
        <tr>
          <td>Power Plant Tour</td>
          <td>56</td>
        </tr>
      </table>
    </div>
  </div>
  
  <div {% get_id_and_classes "news-commitments" %}>
    <div class="{% insert_classes "widget-title" %}">
      My Public Commitments
    </div>
    <div class="{% insert_classes "widget-body" %}">
      <table>
        <tr>
          <th>Commitment</th>
          <th>Expires</th>
        </tr>
        <tr>
          <td>Turn off lights after leaving room</td>
          <td>Tue</td>
        </tr>
        <tr>
          <td>Wash dishes in cold water</td>
          <td>Tue</td>
        </tr>
        <tr>
          <td>Use clothesline</td>
          <td>Wed</td>
        </tr>
        <tr>
          <td>Take bus</td>
          <td>Thu</td>
        </tr>
      </table>
    </div>
  </div>
</div>

<div {% get_id_and_classes "news-wall" %}>
  <div class="{% insert_classes "widget" %}">
    <div class="{% insert_classes "widget-title" %}">
      News Feed
    </div>
    <div class="{% insert_classes "widget-body" %}">
      <div {% get_id_and_classes "wall-form" %}>
        <form id="news-post-form" action="{% url news_post %}" method="POST">
          {% csrf_token %}
          <div id="wall-post-errors"></div>
          <div {% get_id_and_classes "wall-post" %}>
            {{wall_form.post}}
          </div>
          <a id="wall-post-submit" href="#">Post</a>
        </form>
      </div>

      {% if posts %}
        <ul id="wall-posts">
          {% include "news/news_posts.html" %}
        </ul>
      {% else %}
        <p>There are no posts yet!</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}